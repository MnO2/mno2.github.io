<!doctype html>
<html>
    <head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140890995-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-140890995-1');
  </script>
  <meta charset="utf-8">
  <title>Paul Meng's Blog</title>
  <link rel="canonical" href="https://blog.paulme.ng" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="AhCspkSlkxfv5A28XyOOTijnA59_q-V8rJzKakb4CFA" />

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

  <meta property="og:title" content="Paul Meng's Blog" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://blog.paulme.ng" />

  <link href="https://fonts.googleapis.com/css?family=EB+Garamond|Roboto&display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+JP|Noto+Sans+TC&display=optional" rel="stylesheet"> 
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css">
  <link rel="stylesheet" href="./stylesheets/customize-1622403341.css">
  <style>
    html, button, input, select, textarea,
    .pure-g [class *= "pure-u"] {
      font-family: 'Roboto', 'Noto Sans TC', 'Noto Sans JP', sans-serif;
    }

    .post-title {
      font-family: 'EB Garamond', 'Noto Sans TC', 'Noto Sans JP', serif;
    }
  </style>
</head>

    <body>
        <div class="pure-menu pure-menu-horizontal">
            <ul class="pure-menu-list">
                <li class="pure-menu-item"><a href="./about" class="pure-menu-link">About</a></li>
                <li class="pure-menu-item"><a href="./archive.html" class="pure-menu-link">Archive</a></li>
                <li class="pure-menu-item"><a href="./rss/feed.xml" class="pure-menu-link">Subscribe</a></li>
            </ul>
        </div>
        <main class="content" role="main">
            
                <article class="post">
                    <div class="pure-g">
  <div class="pure-u-md-1-5"></div>
  <div class="pure-u-1 pure-u-md-3-5">
    <h1 class="post-title is-center"><a href="./posts/2023-04-09-%E8%82%A1%E5%B8%82%E7%8B%99%E6%93%8A%E6%89%8B%E7%9A%84%E8%87%AA%E7%99%BD%E8%AE%80%E5%BE%8C%E6%84%9F.html">股市狙擊手的自白讀後感</a></h1>
    <div class="post-meta"><time datetime="2023-04-09 19:37">2023-04-09 19:37</time> </span>
    <div class="slot-content">
      <article>
        <p>趁著四月初這波長假看了這個幾個台灣股市幾個知名人物推薦的書，在心路歷程記錄類的算是不錯的，個人是覺得比 MGK 那一本寫得要好多了。書裡面並沒有著墨於什麼技巧，比較特別的是他是在有小兒科醫生本職的情況下發展出一套靠槓桿，單壓一支股票，一年最多做五隻波段的方式讓資產在過去幾年翻了 500%。在 PTT 也有看到在台股用單壓的方法在過去幾年翻了數倍的人，一個我知道的是 mytropicfish，另一個企鵝。只是兩位似乎都沒有用槓桿只是壓很重。而企鵝在 2022 年繼續單壓但獲利大幅回吐。其實不確定這樣的方法是不是在過去幾年比較容易回下來，所以要複製可能要小心近因偏誤就是。我個人比較相信 mytropicfish 重壓台股冷門股的方式比較有可能被複製，只是台股相對歐美法律在公司治理上還是比較不規範，在台股重壓冷門股可能都要對老闆做好盡職調查，而且最好是偏生活類股你可以用 side channel 去驗證減低詐騙的機率就是，而且台灣的利率還是相對低的。在低利率又容易借到錢的環境下公司都不太容易爆掉，所以重壓很可能 make sense，連各種騙錢的 stonks 都可以飛天了，只是不是經營太差的理論上更不可能爆掉，只要等到題材然後飛天就可以了。在 2023 年美國利率已經升到近 5% 又加上中小銀行的 credit crunch，在美國鐵定是最好不要這樣複製。台灣也許還有機會，不過 2% 可能對於槓桿槓太多的公司還是一大逆風。邏輯思考下這樣的作法有可能有它時代背景的限制在，除非確定在選股上有異於常人的優勢，不然實在不推薦在 2023 年複製用這樣的作法。不過把這個做法擺在心中，也許十年二十年後，另一波潮流來臨時，可以記得這樣的做法在那個時候把握時代的優勢。</p>
<p>另一點有趣的是作者是在另有本職的情況下辦到的，在另一本社畜的財務自由計畫的作者也是如此。兩個作者在韓國股市都是用 Swing Trade。不確定韓國股市有多 efficient，有鑑於台灣產業跟韓國產業組成沒有差太多的情況下 (週期強的半導體產業組成為重)，台股應該也辦得到吧。mytropicfish 分享的也是在他有本職的情況下做到的，在他文章中也說到其實在有本職，特別是管理職的情況下，對於生意本職有敏感度反而對於產業的趨勢有把握，能夠做得不錯。變成全職之後雖然自由但也有各種不方便 (像是不易貸款，要擔心生活的現金流，失去產業敏感度，失去社交圈)。對於做美股這麼有效率的市場是否能辦到我就不確定了。不過有本職且操作不錯的這種生活型態很接近我理想中的狀態，有了工作的現金流對於心態上也會比較穩定。希望我有朝一日也能辦到。</p>
<p>書的後段著墨於心理面，特別強調當低潮的時候如何改善，還有當不順的時候可以對股票失去信心但不能對於自己失去信心。這其實跟我這幾年的摸索很像。而且這也不僅僅是股票市場而已。其實人生各方面都是如此。文字寫得精煉但也許只有走過一遭的人才能體會箇中深意，如果沒有經驗的話可能並不會對於他的文字有所共鳴。我特別喜歡一個段落就是把目標設定過高而躁進反而讓自己操作亂掉的經驗，當失望而沒有想太多去操作的時候，反而一切開始改善。這也跟快樂操盤人講得慢慢來比較快一樣。當有了貪念而心態亂掉的時候，反而讓自己的步調亂掉。把眼前的事情做好不要想太多，慢慢累積並且當時機來臨的時候自然會水到渠成。書本的這段章節看起來是對於內心是特別療愈就是。</p>

      </article>
    </div>
  </div>
  <div class="pure-u-md-1-5"></div>
</div>

                </article>
            
                <article class="post">
                    <div class="pure-g">
  <div class="pure-u-md-1-5"></div>
  <div class="pure-u-1 pure-u-md-3-5">
    <h1 class="post-title is-center"><a href="./posts/2021-12-29-zw-fast-quantile%3A-approximate-quantile-for-high-speed-data-stream.html">zw-fast-quantile: Approximate Quantile for high-speed data stream in Rust</a></h1>
    <div class="post-meta"><time datetime="2021-12-29 23:54">2021-12-29 23:54</time> </span>
    <div class="slot-content">
      <article>
        <p>A couple of weeks ago I exchanged messages with <a href="https://github.com/ljw1004">ljw1004</a>, where he was surveying fast quantiles implementation in rust. He conducted a thorough <a href="https://github.com/postmates/quantiles/issues/32">benchmark</a> against the GK01 and CKMS algorithms in the <a href="https://github.com/postmates/quantiles">postmates/quantiles</a> crate, in order to understand the tradeoffs among the error rate, memory usage and the update/query time. He mentioned the Zhang Wang algorithm in a <a href="https://github.com/postmates/quantiles/issues/33">literature review</a>, where I later found that it was actually adopted in the boosted tree implementation in <a href="https://android.googlesource.com/platform/external/tensorflow/+/6341b8975b7660244e1ca3003bfce5371f1fd167/tensorflow/core/kernels/boosted_trees/quantiles/weighted_quantiles_stream.h#30">Tensorflow</a>. I got intrigued and decided to roll my sleeves and give it a shot to implement the algorithm in rust</p>
<p>I spent a few days to read the <a href="http://web.cs.ucla.edu/~weiwang/paper/SSDBM07_2.pdf">paper</a> and read the reference implementation done by <a href="https://github.com/jasonge27/fastQuantile">jasonge27</a> in C++. The C++ implementation only implemented the fixed size approach in the paper but lack the generalized approach to support the online streaming update. I read the paper carefully and implement the generalized algorithm and then we have <a href="https://github.com/MnO2/zw-fast-quantile">zw-fast-quantile</a> crate.</p>
<p>The naive benchmark with criterion shows that the update operation is 2.6x faster than GK01 implementation in <a href="https://github.com/postmates/quantiles">postmates/quantiles</a></p>
<pre><code>zw unbound quantile update
                        time:   [60.780 us 60.855 us 60.936 us]
                        change: [-1.4032% -0.9510% -0.5005%] (p = 0.00 &lt; 0.05)
                        Change within noise threshold.
Found 8 outliers among 100 measurements (8.00%)
  2 (2.00%) high mild
  6 (6.00%) high severe</code></pre>
<pre><code>gk quantile update      time:   [156.84 us 157.02 us 157.24 us]
                        change: [-0.1907% -0.0503% +0.0969%] (p = 0.50 &gt; 0.05)
                        No change in performance detected.
Found 11 outliers among 100 measurements (11.00%)
  6 (6.00%) high mild
  5 (5.00%) high severe</code></pre>
<p>and query operation is 1.5x faster than GK01</p>
<pre><code>zw unbound quantile query
                        time:   [229.62 ns 230.16 ns 230.77 ns]
                        change: [+1.3422% +1.8105% +2.2504%] (p = 0.00 &lt; 0.05)
                        Performance has regressed.
Found 11 outliers among 100 measurements (11.00%)
  3 (3.00%) high mild
  8 (8.00%) high severe</code></pre>
<pre><code>gk quantile query       time:   [350.21 ns 350.48 ns 350.76 ns]
                        change: [-0.4638% -0.3109% -0.1670%] (p = 0.00 &lt; 0.05)
                        Change within noise threshold.
Found 8 outliers among 100 measurements (8.00%)
  1 (1.00%) low severe
  2 (2.00%) high mild
  5 (5.00%) high severe</code></pre>
<p>It matches with the emprical study from the paper that it is able to achieve 200-300x speedup over GK01.</p>
<p>To benchmark the memory usage, by storing complete 100M values in the <code>Vec</code> and calculating the quantiles is using up <code>7812k</code> of heap, and with the error rate set to <code>0.01</code> the <code>zw-fast-quantile</code> is only using up <code>1947k</code> of heap. It looks like it fulfills the goal of approximate quantile by saving the storage size without sacrificing the precision too much.</p>
<p>Implementing <code>zw-fast-quantile</code> is a lot of fun and I learned a lot. By reading the review <a href="https://arxiv.org/pdf/2004.08255.pdf">paper</a> now I understand we can categorize the approximate quantile algorithm by different use cases. They could be</p>
<ol type="1">
<li>Streaming Model: Your data would arrive one by one and you might not know the size of your stream beforehand. You should be able to calculate the result in one pass without blowing up the memory. You might also improve the algorithm complexity if you know that you just gonna query the quantiles for the trailing N values.</li>
<li>Distributed Model: where you have a network of nodes, each of them have some values. However, the communication cost is high and you would like to avoid the communication cost as much as possible.</li>
<li>Update Time: In the real-time application like video/audio streaming, your data update would be very fast and it requires you the low latency on your update time. You would like to strike a balance between update time and the space complexity and accuracy.</li>
<li>Data Skewness: The famous t-digest would leverage on the fact where the error percentage is more imporatnt to the 99th percentile than 50th percentile. By leveraging the data skewness you can invent another set of algorithms.</li>
</ol>
<p><code>zw-fast-quantile</code> is falling on the category 3, and it is good to know that it influenced the implementation in Tensorflow’s boosted trees. It could be another handy algorithm put in your toolbox and use it when the use case is right.</p>

      </article>
    </div>
  </div>
  <div class="pure-u-md-1-5"></div>
</div>

                </article>
            
        </main>

        <div class="pure-g">
          <div class="pure-u-md-1-5"></div>
          <div class="pure-u-md-3-5">
          <nav class="main-nav">
            
            <span class="newer-posts">
              
            </span>
            
            
            <span class="older-posts" style="float:right">
              <a href="./2/">Older Posts &rarr;</a>
            </span>
            
          </nav>
          </div>
          <div class="pure-u-md-1-5"></div>
        </div>

        <div class="pure-g">
          <div class="pure-u-md-1-5"></div>
          <div class="pure-u-1 pure-u-md-3-5">
            <div class="page-number is-center">Page 1 of 59</div>
            <footer class="site-footer">
              <div class="inner is-center">
                <section class="copyright">All contents are copyrighted by Paul Meng, CC BY-NC-SA © 2019</section>
              </div>
            </footer>
          </div>
          <div class="pure-u-md-1-5"></div>
        </div>
    </body>
</html>
